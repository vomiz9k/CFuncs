Turbo Assembler	 Version 4.1	    05/13/20 20:37:27	    Page 1
cfuncs.asm



      1	    0000			 .model	tiny
      2	    0000			 .code
      3					 .386
      4					 org 100h
      5
      6	    0100			 start:
      7
      8	    0100  BF 0000r			 mov di, offset	str1
      9	    0103  B0 65				 mov al, 'e'
     10	    0105  B9 0007			 mov cx, 7d
     11	    0108  E8 00AE			 call memchr
     12	    010B  3A 05				 cmp al, [di]
     13	    010D  0F 85	0097			 jne exit
     14
     15
     16	    0111  BF 0016r			 mov di, offset	str3
     17	    0114  B0 62				 mov al, 'b'
     18	    0116  B9 0005			 mov cx, 5d
     19	    0119  E8 00A2			 call memset
     20	    011C  80 3E	001Ar 62		 cmp [str3 + 4], 'b'
     21	    0121  0F 85	0083			 jne exit
     22	    0125  80 3E	001Br 61		 cmp [str3 + 5], 'a'
     23	    012A  75 7C	90 90			 jne exit
     24
     25
     26	    012E  BF 0000r			 mov di, offset	str1
     27	    0131  BE 000Br			 mov si, offset	str2
     28	    0134  B9 0006			 mov cx, 6d
     29	    0137  E8 008E			 call memcmp
     30	    013A  3C 0F				 cmp al, 'w' - 'h'
     31	    013C  75 6A	90 90			 jne exit
     32
     33
     34	    0140  BF 0016r			 mov di, offset	str3
     35	    0143  BE 0000r			 mov si, offset	str1
     36	    0146  B9 000A			 mov cx, 10d
     37	    0149  E8 0078			 call memcpy
     38	    014C  BF 0016r			 mov di, offset	str3
     39	    014F  BE 0000r			 mov si, offset	str1
     40	    0152  B9 000A			 mov cx, 10d
     41	    0155  E8 0070			 call memcmp
     42	    0158  3C 00				 cmp al, 0
     43	    015A  75 4C	90 90			 jne exit
     44
     45
     46
     47	    015E  BF 0000r			 mov di, offset	str1
     48	    0161  E8 0077			 call strlen
     49	    0164  83 F9	0A			 cmp cx, 10d
     50	    0167  75 3F	90 90			 jne exit
     51
     52
     53
     54	    016B  BF 0000r			 mov di, offset	str1
     55	    016E  B0 77				 mov al, 'w'
     56	    0170  E8 0079			 call strchr
     57	    0173  38 04				 cmp [si], al
Turbo Assembler	 Version 4.1	    05/13/20 20:37:27	    Page 2
cfuncs.asm



     58	    0175  75 31	90 90			 jne exit
     59
     60
     61
     62	    0179  BF 0000r			 mov di, offset	str1
     63	    017C  B0 65				 mov al, 'e'
     64	    017E  E8 0084			 call strrchr
     65	    0181  38 04				 cmp [si], al
     66	    0183  75 23	90 90			 jne exit
     67
     68
     69
     70	    0187  BF 0000r			 mov di, offset	str1
     71	    018A  BE 000Br			 mov si, offset	str2
     72	    018D  E8 0092			 call strcmp
     73	    0190  83 F9	0F			 cmp cx, 'w' - 'h'
     74	    0193  75 13	90 90			 jne exit
     75
     76
     77	    0197  B4 02				 mov ah, 02h
     78	    0199  B2 6F			     mov dl, 'o'
     79	    019B  CD 21			     int 21h
     80	    019D  B4 02				 mov ah, 02h
     81	    019F  B2 6B			     mov dl, 'k'
     82	    01A1  CD 21			     int 21h
     83	    01A3  B8 4C00			 mov ax, 4c00h
     84	    01A6  CD 21				 int 21h
     85
     86
     87	    01A8				 exit:
     88	    01A8  B4 02				 mov ah, 02h
     89	    01AA  B2 6E			     mov dl, 'n'
     90	    01AC  CD 21			     int 21h
     91	    01AE  B4 02				 mov ah, 02h
     92	    01B0  B2 6F			     mov dl, 'o'
     93	    01B2  CD 21			     int 21h
     94	    01B4  B8 4C00			 mov ax, 4c00h
     95	    01B7  CD 21				 int 21h
     96
     97					 ;------------------------------------------
     98					 ;memchr
     99					 ;	 di - offset of	memory
    100					 ;	 al - searching	char
    101					 ;	 cx - count of searching symbols
    102					 ;Returns : di - pointer of sym
    103					 ;Destroyed: di
    104					 ;------------------------------------------
    105	    01B9			 memchr:
    106	    01B9  FC				 cld
    107	    01BA  F2> AE			 repne scasb
    108	    01BC  4F				 dec di
    109	    01BD  C3				 ret
    110
    111
    112					 ;------------------------------------------
    113					 ;memset
    114					 ;Parameters:
Turbo Assembler	 Version 4.1	    05/13/20 20:37:27	    Page 3
cfuncs.asm



    115					 ;	 bx - offset of	mem
    116					 ;	 al - char
    117					 ;	 cx - count
    118					 ;Returns: bx -	offset of mem
    119					 ;Destroyed: cx, di, bx
    120					 ;------------------------------------------
    121	    01BE			 memset:
    122	    01BE  FC				 cld
    123	    01BF  8B DF				 mov bx, di
    124	    01C1  F3> AA			 rep stosb
    125
    126	    01C3  C3				 ret
    127
    128					 ;------------------------------------------
    129					 ;memcpy
    130					 ;Parameters:
    131					 ;	 di - offset of	dest
    132					 ;	 si - offset of	src
    133					 ;	 cx - count
    134					 ;Returns: di -	dest
    135					 ;Destroyed: cx, di, si
    136
    137					 ;------------------------------------------
    138	    01C4			 memcpy:
    139	    01C4  FC				 cld
    140	    01C5  F3> A4			 rep movsb
    141	    01C7  C3				 ret
    142
    143
    144
    145					 ;------------------------------------------
    146					 ;memcmp
    147					 ;Parameters:
    148					 ;	 di - offset of	mem1
    149					 ;	 si - offset of	mem2
    150					 ;	 cx - count
    151					 ;Destroyed: cx, di, si
    152					 ;Returns: al: first [di] - [bi] != 0 (0 if all	symbols	are equal)
    153					 ;------------------------------------------
    154	    01C8			 memcmp:
    155	    01C8  FC					 cld
    156	    01C9  F3> A6				 repe cmpsb
    157	    01CB  74 0B	90 90				 je equal
    158
    159
    160	    01CF  8A 45	FF				 mov al, [di - 1]
    161	    01D2  8A 5C	FF				 mov bl, [si - 1]
    162	    01D5  2A C3					 sub al, bl
    163	    01D7  C3					 ret
    164
    165	    01D8				 equal:
    166	    01D8  33 C0					 xor ax, ax
    167	    01DA  C3					 ret
    168
    169
    170					 ;------------------------------------------
    171					 ;Counts length	of string
Turbo Assembler	 Version 4.1	    05/13/20 20:37:27	    Page 4
cfuncs.asm



    172					 ;Parameters:
    173					 ;	 di - offset of	string
    174					 ;Returns:
    175					 ;	 cx - length of	string
    176					 ;Destroyed: ax, di
    177					 ;------------------------------------------
    178	    01DB			 strlen:
    179	    01DB  33 C9					 xor cx, cx
    180	    01DD  F7 D1					 not cx
    181	    01DF  33 C0					 xor ax, ax
    182	    01E1  FC					 cld
    183	    01E2  F2> AE				 repne scasb
    184	    01E4  F7 D0					 not ax
    185	    01E6  2B C1					 sub ax, cx
    186	    01E8  8B C8					 mov cx, ax
    187	    01EA  49					 dec cx
    188	    01EB  C3					 ret
    189
    190					 ;------------------------------------------
    191					 ;Finds	first char in string same as given
    192					 ;Parameters:
    193					 ;	 di - offset of	string,	al - char
    194					 ;Returns:
    195					 ;	 si - pointer of searching char(nullptr	if not found)
    196					 ;Destroyed: di, ax, bx
    197					 ;------------------------------------------
    198	    01EC			 strchr:
    199	    01EC  8A D8					 mov bl, al
    200	    01EE  8B F7					 mov si, di
    201	    01F0  E8 FFE8				 call strlen
    202	    01F3  8A C3					 mov al, bl
    203	    01F5  8B FE					 mov di, si
    204
    205
    206	    01F7  FC					 cld
    207	    01F8  F2> AE				 repne scasb
    208	    01FA  75 06	90 90				 jne not_found
    209
    210
    211	    01FE  8B F7					 mov si, di
    212	    0200  4E					 dec si
    213	    0201  C3					 ret
    214
    215
    216	    0202				 not_found:
    217	    0202  33 F6					 xor si, si
    218	    0204  C3					 ret
    219
    220					 ;------------------------------------------
    221					 ;Finds	last char in string same as given
    222					 ;Parameters:
    223					 ;	 di - offset of	string,	al - char
    224					 ;Returns:
    225					 ;	 si - pointer of searching char(nullptr	if not found)
    226					 ;Destroyed: di, ax, bx
    227					 ;------------------------------------------
    228	    0205			 strrchr:
Turbo Assembler	 Version 4.1	    05/13/20 20:37:27	    Page 5
cfuncs.asm



    229	    0205  8A D8					 mov bl, al
    230	    0207  8B F7					 mov si, di
    231	    0209  E8 FFCF				 call strlen
    232	    020C  8A C3					 mov al, bl
    233	    020E  8B FE					 mov di, si
    234
    235	    0210  03 F9					 add di, cx
    236
    237	    0212  FD					 std
    238	    0213  F2> AE				 repne scasb
    239	    0215  75 08	90 90				 jne rnot_found
    240
    241	    0219  83 C7	01				 add di, 1
    242	    021C  8B F7					 mov si, di
    243	    021E  C3					 ret
    244
    245	    021F				 rnot_found:
    246	    021F  33 F6					 xor si, si
    247	    0221  C3					 ret
    248
    249					 ;------------------------------------------
    250					 ;Compares two strings
    251					 ;Parameters:
    252					 ;	 di - offset of	string1, si - offset of	string2
    253					 ;Returns:
    254					 ;	 cx - difference between two different symbols in strings(0 if both equal)
    255					 ;Destroyed: di, si, ax, bx
    256					 ;------------------------------------------
    257	    0222			 strcmp:
    258	    0222  8A 04					 mov al, [si]
    259	    0224				 strcmp_loop:
    260	    0224  38 05					 cmp [di], al
    261	    0226  75 0A	90 90				 jne strcmp_end
    262	    022A  46					 inc si
    263	    022B  47					 inc di
    264	    022C  8A 04					 mov al, [si]
    265	    022E  3C 00					 cmp al, 0
    266	    0230  75 F2					 jne strcmp_loop
    267
    268	    0232				 strcmp_end:
    269	    0232  32 ED					 xor ch, ch
    270	    0234  8A 0D					 mov cl, [di]
    271	    0236  2A 0C					 sub cl, [si]
    272	    0238  C3					 ret
    273					 ;-------------------------------------------
    274
    275	    0239			 .data
    276	    0000  68 65	6C 6C 6F 77 6F+	 str1 db 'helloworld', 0h
    277		  72 6C	64 00
    278	    000B  68 65	6C 6C 6F 68 65+	 str2 db 'hellohello', 0h
    279		  6C 6C	6F 00
    280	    0016  61 61	61 61 61 61 61+	 str3 db 'aaaaaaaaaa', 0h
    281		  61 61	61 00
    282		  =000A			 str_len equ 10d
    283
    284					 end start
Turbo Assembler	 Version 4.1	    05/13/20 20:37:27	    Page 6
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "05/13/20"
??FILENAME			  Text	 "cfuncs  "
??TIME				  Text	 "20:37:27"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0F0FH
@CURSEG				  Text	 _DATA
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 CFUNCS
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
EQUAL				  Near	 DGROUP:01D8
EXIT				  Near	 DGROUP:01A8
MEMCHR				  Near	 DGROUP:01B9
MEMCMP				  Near	 DGROUP:01C8
MEMCPY				  Near	 DGROUP:01C4
MEMSET				  Near	 DGROUP:01BE
NOT_FOUND			  Near	 DGROUP:0202
RNOT_FOUND			  Near	 DGROUP:021F
START				  Near	 DGROUP:0100
STR1				  Byte	 DGROUP:0000
STR2				  Byte	 DGROUP:000B
STR3				  Byte	 DGROUP:0016
STRCHR				  Near	 DGROUP:01EC
STRCMP				  Near	 DGROUP:0222
STRCMP_END			  Near	 DGROUP:0232
STRCMP_LOOP			  Near	 DGROUP:0224
STRLEN				  Near	 DGROUP:01DB
STRRCHR				  Near	 DGROUP:0205
STR_LEN				  Number 000A

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0021 Word	  Public  DATA
  _TEXT				  16  0239 Word	  Public  CODE
